function addFormRow(c,b,i,e,d,a){if(typeof(e)==="undefined"){e=""}if(typeof(d)==="undefined"){d=""}if(typeof(a)==="undefined"){a=""}var j=c.data("prototype");var f=c.data("index");var h=j.replace(/__name__/g,f);c.data("index",f+1);var g=$("#"+i).append('<div id="'+i+f+'" class="newFormLine">'+e+h+d+"</div>");b.before(g);addFormDeleteLink($("#"+i+f),a);$("#"+i+f+" :input").first().focus()}function addFormDeleteLink(a,b){if(typeof(b)==="undefined"){b=""}var c=$('<a href="#"><i class="fa fa-times"></i> Remove</a>');a.find(b+" .form-values").append(c);c.on("click",function(d){d.preventDefault();a.remove()})}function setTitleAccordionRow(a){$("#"+a+" a[data-parent=#"+a+"]").each(function(){var c=$(this).parent().parent().find(":input").first();var b=$(this).find(".accordion-title");c.off("change");c.on("change",function(d){if($(this).val()==""){b.text("New")}else{b.text($(this).val())}});c.triggerHandler("change")})}function addRemoveFormChoiceOptions(b){var d=$("#"+b+"_choiceOptions");var a=$('<a href="#"><i class="fa fa-plus"></i> Add a choice option</a>');var c=$("#"+b+"_choiceOptions").after(a);d.append(c);d.data("index",d.find(":input").length);d.find(".form-group").each(function(){addFormDeleteLink($(this),"")});a.on("click",function(f){f.preventDefault();addFormRow(d,c,b+"_choiceOptions")});fixPrototypeColsize()}function showHideFormChoiceOptions(a){$("#"+a+"_type").on("change",function(b){if($(this).val()=="choice"){$("#"+a+"_choiceOptions").parent().parent().show("slow");$("#"+a+"_choiceExpanded").parent().parent().show("slow")}else{$("#"+a+"_choiceOptions").parent().parent().hide("slow");$("#"+a+"_choiceExpanded").parent().parent().hide("slow")}});$("#"+a+"_type").triggerHandler("change")}function setupAccordion(d,a,e){if(e){$("#"+d).sortable({items:":not(.notSortable)",}).bind("sortupdate",function(){var g=0;$(this).find(".panel-body").each(function(){$(this).find(":input[type=hidden]").each(function(){subName=$(this).attr("name").split("[");if(subName[subName.length-1]=="position]"){$(this).val(g)}});g++})});$("#"+d+" [data-toggle='collapse']").append('<i class="fa fa-arrows pull-right"></i>')}var c=$("#"+d);var f=$('<a href="#"><i class="fa fa-plus"></i> '+a+"</a>");var b=c.after(f);c.append(b);c.data("index",c.find(".panel-heading").length);c.find(".panel-default").each(function(){addFormDeleteLink($(this),".removeRow");var h=$(this).find(":input").first().prop("id");var g=h.substr(0,h.lastIndexOf("_"));addRemoveFormChoiceOptions(g);showHideFormChoiceOptions(g)});accordionIndex=1;f.on("click",function(g){g.preventDefault();addFormRow(c,b,d,'<div class="panel panel-default"><div class="panel-heading"><a data-toggle="collapse" data-parent="#'+d+'" href="#new'+d+"-"+accordionIndex+'"><span class="accordion-title"></span></a></div><div id="new'+d+"-"+accordionIndex+'" class="panel-collapse collapse"><div class="panel-body">','<div class="form-group removeRow"><label class="col-sm-2 control-label"></label><div class="col-sm-10 form-values"></div></div></div></div></div>',".removeRow");var i=$("#new"+d+"-"+accordionIndex+" :input").first().prop("id");var h=i.substr(0,i.lastIndexOf("_"));addRemoveFormChoiceOptions(h);$("#"+h+"_choiceOptions").append('<p class="form-control-static">Please save the form first before adding choice options.</p>');$("#"+h+"_choiceOptions").parent().find("a").remove();showHideFormChoiceOptions(h);if(typeof newPrototypeHook=="function"){newPrototypeHook($("#new"+d+"-"+accordionIndex))}$("#new"+d+"-"+accordionIndex).collapse("show");accordionIndex++;setTitleAccordionRow(d)});setTitleAccordionRow(d)}function fixPrototypeColsize(){$(".form-values div[data-prototype]").each(function(){newPrototype=$(this).attr("data-prototype").replace("col-sm-10","col-sm-8");$(this).attr("data-prototype",newPrototype);$(this).removeClass("form-control");$(this).find(".form-values").each(function(){$(this).removeClass("col-sm-10").addClass("col-sm-8")})})};